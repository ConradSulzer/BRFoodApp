var app={init:function(){var e=app.sessStore("settings");if(!Boolean(e)){app.sessStore("settings",{delivery:!1,onlineOrder:!1,patio:!1})}var t=app.store("locExpire");Boolean(t)&&((new Date).getTime()>t+864e5&&localStorage.clear());var n=app.store("restArray");Boolean(n)&&restList.length!==n.length&&app.prepData(),$("#autocomplete").autocomplete({lookup:searchAutoCompArray,lookupLimit:6,width:"auto",showNoSuggestionNotice:!0,noSuggestionNotice:"No matching results...",onSelect:function(e){document.getElementById("autocomplete").value="",app.popUpCard(restList[e.data])}}),window.sessionStorage.removeItem("filter"),view.render(),app.eventliseners()},eventliseners:function(){var e=document.getElementById("toggleRow"),t=document.getElementsByClassName("loadMoreClass");document.getElementById("randomizerClose");e.addEventListener("change",function(e){if("onlineOnly"===e.target.id){var t=event.target.checked;(n=app.sessStore("settings")).onlineOrder=t,app.sessStore("settings",n),view.render()}if("deliveryOnly"===e.target.id){t=event.target.checked;(n=app.sessStore("settings")).delivery=t,app.sessStore("settings",n),view.render()}if("patioToggle"===e.target.id){var n;t=event.target.checked;(n=app.sessStore("settings")).patio=t,app.sessStore("settings",n),view.render()}});for(var n=0;n<t.length;n++)t[n].addEventListener("click",function(){for(var e=document.getElementsByClassName("loadMoreDiv"),t=0;t<e.length;t++)e[t].style.display="none";setTimeout(view.populateList,15)})},autoComp:function(){var e=document.getElementById("searchInput"),t=app.store("userLoc");autocomplete=new google.maps.places.Autocomplete(e),google.maps.event.addListener(autocomplete,"place_changed",function(e){var n=autocomplete.getPlace(),r=[n.geometry.location.lat(),n.geometry.location.lng(),n.name];window.localStorage.clear(),Boolean(t)&&(localStorage.removeItem("userLoc"),localStorage.removeItem("locExpire")),app.store("userLoc",r),app.prepData(),view.render()})},prepData:function(){var e=restList,t=app.store("userLoc"),n=t[0],r=t[1],o=e.map(function(e){return e.distance=1*app.findDist(n,r,e.lat,e.long),e});arraySorted=_.sortBy(o,"distance"),app.store("restArray",arraySorted)},findDist:function(e,t,n,r){var o=Math.PI*e/180,a=Math.PI*n/180,i=(Math.PI,Math.PI,t-r),s=Math.PI*i/180,l=Math.sin(o)*Math.sin(a)+Math.cos(o)*Math.cos(a)*Math.cos(s);return(l=60*(l=180*(l=Math.acos(l))/Math.PI)*1.1515).toFixed(2)},geoFindMe:function(){var e=app.store("userLoc");navigator.geolocation?navigator.geolocation.getCurrentPosition(function(t){var n=(new Date).getTime(),r=[t.coords.latitude,t.coords.longitude];Boolean(e)&&(localStorage.removeItem("userLoc"),localStorage.removeItem("locExpire")),app.store("userLoc",r),app.store("locExpire",n),app.prepData(),view.render()},function(){alert("Whoops, that's not supposed to happen. Please, try again.")}):alert("Geolocation is not supported by your browser")},popUpCard:function(e){var t=document.getElementById("injectRandomCard"),n=document.getElementById("cardTemplate").innerHTML,r=_.template(n)(e);t.innerHTML=r,document.querySelector(".mainListChild").className="",$("#randomBox").modal("show"),app.screenDimmer(!1)},store:function(e,t){if(arguments.length>1)return localStorage.setItem(e,JSON.stringify(t));var n=localStorage.getItem(e);return n&&JSON.parse(n)},sessStore:function(e,t){if(arguments.length>1)return sessionStorage.setItem(e,JSON.stringify(t));var n=sessionStorage.getItem(e);return n&&JSON.parse(n)},screenDimmer:function(e){document.getElementById("screenDimmer").style.display=e?"block":"none",document.getElementById("loadFlasher").style.display=e?"block":"none"},triggerRandom:function(){app.screenDimmer(!0);var e,t=app.store("restArray");Boolean(t)&&(e=t.findIndex(function(e){return e.distance>5}));var n=Math.floor(Math.random()*Math.floor(e>1?e:restList.length)),r=e>1?t[n]:restList[n];setTimeout(function(){app.popUpCard(r)},3e3)}},view={render:function(){mainList.innerHTML="";var e=app.store("userLoc");Boolean(e)&&(searchInput=document.getElementById("searchInput"),searchInput.placeholder=e[2]?e[2]:"Current Location");var t=app.sessStore("settings");document.getElementById("onlineOnly").checked=t.onlineOrder,document.getElementById("deliveryOnly").checked=t.delivery,document.getElementById("patioToggle").checked=t.patio,view.populateList(),view.renderFilter()},populateList:function(){app.screenDimmer(!0);var e=app.store("restArray");if(!Boolean(e))e=restList;var t=document.querySelectorAll("div.mainListChild"),n=t.length,r=n,o=n+18,a=document.getElementById("mainList"),i=app.sessStore("settings"),s=app.sessStore("filter");for(r>0&&(r=e.findIndex(function(e,r){if(e._id===t[n-1].id)return r})+1),Boolean(s)&&(document.getElementById("pickRandomBtn").style.display="none",document.getElementById("clearFilter").style.display="",document.getElementById("filterListP").innerHTML="Filters: "+s.filterArray.join(", "),document.getElementById("filterListP").style.display="");a.children.length<o;r++){var l=e[r];if(!(r<e.length)){console.log("end of list");break}if(!i.delivery||l.delivery)if(!i.onlineOrder||l.onlineOrder)if(!i.patio||l.patio)if(!(Boolean(s)&&(Array.isArray(l.genre)||(l.genre=[l.genre]),_.intersection(l.genre,s.filterArray).length<1))){var c=document.getElementById("cardTemplate").innerHTML,p=_.template(c)(l);a.innerHTML+=p}}for(var d=document.getElementsByClassName("loadMoreDiv"),m=0;m<d.length;m++)r<e.length?d[m].style.display="":d[m].style.display="none";app.screenDimmer(!1)},renderFilter:function(){var e=document.getElementById("filterBody");e.innerHTML="";var t=["American","Asian","BBQ","Breakfast","Burgers","Cajun/Creole","Chinese","Crawfish","Desserts","Greek","Italian","Japanese","Lebanese","Mexican","Pizza","Salads","Sandwiches","Seafood","Southern","Sushi","Thai","Vietnamese","Wings"];t.forEach(function(t){t={type:t};var n=document.getElementById("filterTemplate").innerHTML,r=_.template(n)(t);e.innerHTML+=r});var n=document.getElementById("cusineList");n.innerHTML="",t.forEach(function(e){e={type:e};var t=document.getElementById("restCuisineType").innerHTML,r=_.template(t)(e);n.innerHTML+=r})},filterList:function(){var e={filterArray:[]};items=document.getElementsByClassName("filterCheck");for(var t=0;t<items.length;t++)items[t].checked&&e.filterArray.push(items[t].value);e.filterArray.length<1||(app.sessStore("filter",e),view.render())},clearFilters:function(){window.sessionStorage.removeItem("filter"),document.getElementById("clearFilter").style.display="none",document.getElementById("filterListP").style.display="none",document.getElementById("pickRandomBtn").style.display="",view.render()}};app.init();